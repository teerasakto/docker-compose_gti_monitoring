{"version":3,"sources":["../../../src/components/endpoint/endpoint_list.js"],"names":["_","$","EndpointListCtrl","$scope","$injector","$location","$q","backendSrv","contextSrv","alertSrv","isOrgEditor","hasRole","pageReady","filter","sort_field","endpoints","refresh","endpointState","getEndpoints","map","forEach","endpoint","tags","tag","Object","keys","self","get","then","resp","meta","code","set","message","reject","body","type","check","checks","c","toLowerCase","enabled","state","states","duration","Date","getTime","stateChange","secs","Math","floor","mins","hours","days","evt","clickTargetIsLinkOrHasLinkParents","target","closest","length","path","search","slug","url","id","templateUrl"],"mappings":"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","file":"endpoint_list.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\n\nclass EndpointListCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, $q, backendSrv, contextSrv, alertSrv) {\n    this.isOrgEditor = contextSrv.hasRole('Editor') || contextSrv.hasRole('Admin');\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.$q = $q;\n    this.$location = $location;\n    this.pageReady = false;\n    this.filter = {'tag': ''};\n    this.sort_field = 'name';\n    this.endpoints = [];\n    this.refresh();\n    this.endpointState = {\n      \"0\": 0,\n      \"1\": 0,\n      \"2\": 0,\n      \"-1\": 0,\n    };\n  }\n\n  refresh() {\n    this.getEndpoints();\n  }\n\n  endpointTags() {\n    var map = {};\n    _.forEach(this.endpoints, function(endpoint) {\n      _.forEach(endpoint.tags, function(tag) {\n        map[tag] = true;\n      });\n    });\n    return Object.keys(map);\n  }\n\n  setTagFilter(tag) {\n    this.filter.tag = tag;\n  }\n\n  getEndpoints() {\n    var self = this;\n    this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/v2/endpoints').then(function(resp) {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to get endpoint list.\", resp.meta.message, 'error', 10000);\n        return self.$q.reject(resp.meta.message);\n      }\n      self.endpoints = resp.body;\n      self.pageReady = true;\n    });\n  }\n\n  monitorStateTxt(endpoint, type) {\n    var check;\n    _.forEach(endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === type.toLowerCase()) {\n        check = c;\n      }\n    });\n    if (typeof(check) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!check.enabled) {\n      return \"disabled\";\n    }\n    if (check.state < 0 || check.state > 2) {\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[check.state];\n  }\n\n  monitorStateChangeStr(endpoint, type) {\n    var check;\n    _.forEach(endpoint.checks, function(c) {\n      if (c.type.toLowerCase() === type.toLowerCase()) {\n        check = c;\n      }\n    });\n    if (typeof(check) !== \"object\") {\n      return \"\";\n    }\n\n    var duration = new Date().getTime() - new Date(check.stateChange).getTime();\n    if (duration < 10000) {\n      return \"for a few seconds ago\";\n    }\n    if (duration < 60000) {\n      var secs = Math.floor(duration/1000);\n      return \"for \" + secs + \" seconds\";\n    }\n    if (duration < 3600000) {\n      var mins = Math.floor(duration/1000/60);\n      return \"for \" + mins + \" minutes\";\n    }\n    if (duration < 86400000) {\n      var hours = Math.floor(duration/1000/60/60);\n      return \"for \" + hours + \" hours\";\n    }\n    var days = Math.floor(duration/1000/60/60/24);\n    return \"for \" + days + \" days\";\n  }\n\n  gotoDashboard(endpoint, evt) {\n    var clickTargetIsLinkOrHasLinkParents = $(evt.target).closest('a').length > 0;\n    if (clickTargetIsLinkOrHasLinkParents === false) {\n      this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search({\"var-collector\": \"All\", \"var-endpoint\": endpoint.slug});\n    }\n  }\n\n  gotoEndpointURL(endpoint) {\n    this.$location.url('plugins/raintank-worldping-app/page/endpoint-details?endpoint='+ endpoint.id);\n  }\n}\n\nEndpointListCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/endpoint/partials/endpoint_list.html';\nexport {EndpointListCtrl};\n"]}