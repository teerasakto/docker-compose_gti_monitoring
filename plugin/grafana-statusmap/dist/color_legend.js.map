{"version":3,"sources":["../src/color_legend.js"],"names":["drawColorLegend","elem","colorScheme","rangeFrom","rangeTo","maxValue","minValue","legendElem","$","find","legend","d3","select","get","clearLegend","legendWidth","Math","floor","outerWidth","legendHeight","attr","rangeStep","MIN_LEGEND_STEPS","widthFactor","valuesRange","range","colorScale","getColorScale","selectAll","data","enter","append","d","drawLegendValues","drawOpacityLegend","options","opacityScale","getOpacityScale","cardColor","style","drawDiscreteColorLegend","colorOptions","discreteHelper","thresholds","tooltips","_","map","tr","tooltip","valuesNumber","length","$heatmap","parent","graphWidth","textWidth","text","each","i","thisWidth","getBBox","width","push","remove","min","max","itemWidth","getDiscreteColor","drawDiscreteLegendValues","childNodes","legendValueScale","scaleLinear","domain","ticks","buildLegendTicks","xAxis","axisBottom","tickValues","tickSize","colorRect","posY","getSvgElemHeight","posX","getSvgElemX","call","thresholdValues","thresholdTooltips","value","tickFormat","t","v","undefined","drawSimpleColorLegend","legendRects","drawSimpleOpacityLegend","graphElem","legendOpacityScale","scalePow","exponent","empty","colorInterpolator","d3ScaleChromatic","colorScaleInverted","invert","contextSrv","user","lightTheme","start","end","scaleSequential","svgElem","x","baseVal","height","tickStepSize","tickStep","ticksNum","round","current","isValueCloseTo","sortBy","uniq","val","valueTo","step","diff","abs","angular","mod","module","directive","restrict","template","link","scope","attrs","ctrl","panel","render","events","on","color","mode","colorSchemes","isEmpty","cardsData","cards"],"mappings":"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","file":"color_legend.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport d3 from 'd3';\nimport * as d3ScaleChromatic from './libs/d3-scale-chromatic/index';\nimport {contextSrv} from 'app/core/core';\nimport {tickStep} from 'app/core/utils/ticks';\n\nlet mod = angular.module('grafana.directives');\n\nconst MIN_LEGEND_STEPS = 10;\n\n/**\n * Color legend for heatmap editor.\n */\nmod.directive('optionsColorLegend', function() {\n  return {\n    restrict: 'E',\n    template: '<div class=\"status-heatmap-color-legend\"><svg width=\"16.8rem\" height=\"24px\"></svg></div>',\n    link: function(scope, elem, attrs) {\n      let ctrl = scope.ctrl;\n      let panel = scope.ctrl.panel;\n\n      render();\n\n      ctrl.events.on('render', function() {\n        render();\n      });\n\n      function render() {\n        let legendElem = $(elem).find('svg');\n        let legendWidth = Math.floor(legendElem.outerWidth());\n\n        if (panel.color.mode === 'spectrum') {\n          let colorScheme = _.find(ctrl.colorSchemes, {value: panel.color.colorScheme});\n          let colorScale = getColorScale(colorScheme, legendWidth);\n          drawSimpleColorLegend(elem, colorScale);\n        } else if (panel.color.mode === 'opacity') {\n          let colorOptions = panel.color;\n          drawSimpleOpacityLegend(elem, colorOptions);\n        }\n      }\n    }\n  };\n});\n\n/**\n * Heatmap legend with scale values.\n */\nmod.directive('statusHeatmapLegend', function() {\n  return {\n    restrict: 'E',\n    template: '<div class=\"status-heatmap-color-legend\"><svg width=\"100px\" height=\"6px\"></svg></div>',\n    link: function(scope, elem, attrs) {\n      let ctrl = scope.ctrl;\n      let panel = scope.ctrl.panel;\n\n      render();\n      ctrl.events.on('render', function() {\n        render();\n      });\n\n      function render() {\n        clearLegend(elem);\n        if (!_.isEmpty(ctrl.cardsData) && !_.isEmpty(ctrl.cardsData.cards)) {\n          let rangeFrom = ctrl.cardsData.minValue;\n          let rangeTo = ctrl.cardsData.maxValue;\n          let maxValue = panel.color.max || rangeTo;\n          let minValue = panel.color.min || rangeFrom;\n\n          if (panel.color.mode === 'spectrum') {\n            let colorScheme = _.find(ctrl.colorSchemes, {value: panel.color.colorScheme});\n            drawColorLegend(elem, colorScheme, rangeFrom, rangeTo, maxValue, minValue);\n          } else if (panel.color.mode === 'opacity') {\n            let colorOptions = panel.color;\n            drawOpacityLegend(elem, colorOptions, rangeFrom, rangeTo, maxValue, minValue);\n          } else if (panel.color.mode === 'discrete') {\n            let colorOptions = panel.color;\n            drawDiscreteColorLegend(elem, colorOptions, ctrl.discreteHelper);\n          }\n        }\n      }\n    }\n  };\n});\n\nfunction drawColorLegend(elem, colorScheme, rangeFrom, rangeTo, maxValue, minValue) {\n  let legendElem = $(elem).find('svg');\n  let legend = d3.select(legendElem.get(0));\n  clearLegend(elem);\n\n  let legendWidth = Math.floor(legendElem.outerWidth()) - 30;  // narrow legendWidth by 30px to get space for first and last tick values\n  let legendHeight = legendElem.attr(\"height\");\n\n  let rangeStep = 1;\n  if (rangeTo - rangeFrom > legendWidth) {\n    rangeStep = Math.floor((rangeTo - rangeFrom) / legendWidth);\n  }\n\n  if (rangeStep * MIN_LEGEND_STEPS > rangeTo) {\n    rangeStep = rangeTo / MIN_LEGEND_STEPS;\n  }\n\n  let widthFactor = legendWidth / (rangeTo - rangeFrom);\n  let valuesRange = d3.range(rangeFrom, rangeTo, rangeStep);\n\n  let colorScale = getColorScale(colorScheme, maxValue, minValue);\n  legend.selectAll(\".status-heatmap-color-legend-rect\")\n    .data(valuesRange)\n    .enter().append(\"rect\")\n    .attr(\"x\", d => d * widthFactor + 10) // shift all color rectangles to the right\n    .attr(\"y\", 0)\n    .attr(\"width\", rangeStep * widthFactor + 1) // Overlap rectangles to prevent gaps\n    .attr(\"height\", legendHeight)\n    .attr(\"stroke-width\", 0)\n    .attr(\"fill\", d => colorScale(d));\n\n  drawLegendValues(elem, colorScale, rangeFrom, rangeTo, maxValue, minValue, legendWidth);\n}\n\nfunction drawOpacityLegend(elem, options, rangeFrom, rangeTo, maxValue, minValue) {\n  let legendElem = $(elem).find('svg');\n  let legend = d3.select(legendElem.get(0));\n  clearLegend(elem);\n\n  let legendWidth = Math.floor(legendElem.outerWidth()) - 30;  // narrow legendWidth by 30px to get space for first and last tick values\n  let legendHeight = legendElem.attr(\"height\");\n\n  let rangeStep = 10;\n  let widthFactor = legendWidth / (rangeTo - rangeFrom);\n\n  if (rangeStep * MIN_LEGEND_STEPS > rangeTo) {\n    rangeStep = rangeTo / MIN_LEGEND_STEPS;\n  }\n\n  let valuesRange = d3.range(rangeFrom, rangeTo, rangeStep);\n\n  let opacityScale = getOpacityScale(options, maxValue, minValue);\n  legend.selectAll(\".status-heatmap-opacity-legend-rect\")\n    .data(valuesRange)\n    .enter().append(\"rect\")\n    .attr(\"x\", d => d * widthFactor + 10) // shift all opacity rectangles to the right\n    .attr(\"y\", 0)\n    .attr(\"width\", rangeStep * widthFactor)\n    .attr(\"height\", legendHeight)\n    .attr(\"stroke-width\", 0)\n    .attr(\"fill\", options.cardColor)\n    .style(\"opacity\", d => opacityScale(d));\n\n  drawLegendValues(elem, opacityScale, rangeFrom, rangeTo, maxValue, minValue, legendWidth);\n}\n\nfunction drawDiscreteColorLegend(elem, colorOptions, discreteHelper) {\n  let legendElem = $(elem).find('svg');\n  let legend = d3.select(legendElem.get(0));\n  clearLegend(elem);\n\n  let thresholds = colorOptions.thresholds;\n  let tooltips = _.map(thresholds, tr => tr.tooltip);\n  let valuesNumber = thresholds.length;\n\n  // graph width as a fallback\n  let $heatmap = $(elem).parent().parent().parent().find('.status-heatmap-panel');\n  let graphWidth  = $heatmap.find('svg').attr(\"width\");\n\n  // calculate max width of tooltip and use it as width for each item\n  let textWidth = [];\n  legend.selectAll(\".hidden-texts\")\n    .data(tooltips)\n    .enter().append(\"text\")\n    .attr(\"class\", \"axis tick\")\n    .attr(\"font-family\", \"sans-serif\")\n    .text(d => d)\n    .each(function(d,i) {\n      let thisWidth = this.getBBox().width;\n      textWidth.push(thisWidth);\n      this.remove(); // remove them just after displaying them\n    });\n\n  let legendWidth = Math.floor(_.min([\n    graphWidth - 30,\n    (_.max(textWidth) + 3) * valuesNumber,\n  ]));\n  legendElem.attr(\"width\", legendWidth);\n\n  let legendHeight = legendElem.attr(\"height\");\n\n  let itemWidth  = Math.floor(legendWidth / valuesNumber);\n  let valuesRange = d3.range(valuesNumber); // from 0 to valuesNumber-1\n\n  legend.selectAll(\".status-heatmap-color-legend-rect\")\n    .data(valuesRange)\n    .enter().append(\"rect\")\n    .attr(\"x\", d => d*itemWidth)\n    .attr(\"y\", 0)\n    .attr(\"width\", itemWidth + 1) // Overlap rectangles to prevent gaps\n    .attr(\"height\", legendHeight)\n    .attr(\"stroke-width\", 0)\n    .attr(\"fill\", d => discreteHelper.getDiscreteColor(d));\n\n  drawDiscreteLegendValues(elem, colorOptions, legendWidth);\n}\n\n\nfunction drawLegendValues(elem, colorScale, rangeFrom, rangeTo, maxValue, minValue, legendWidth) {\n  let legendElem = $(elem).find('svg');\n  let legend = d3.select(legendElem.get(0));\n\n  if (legendWidth <= 0 || legendElem.get(0).childNodes.length === 0) {\n    return;\n  }\n\n  let legendValueScale = d3.scaleLinear()\n    .domain([0, rangeTo])\n    .range([0, legendWidth]);\n\n  let ticks = buildLegendTicks(0, rangeTo, maxValue, minValue);\n  let xAxis = d3.axisBottom(legendValueScale)\n    .tickValues(ticks)\n    .tickSize(2);\n\n  let colorRect = legendElem.find(\":first-child\");\n  let posY = getSvgElemHeight(legendElem) + 2;\n  let posX = getSvgElemX(colorRect);\n\n  d3.select(legendElem.get(0)).append(\"g\")\n    .attr(\"class\", \"axis\")\n    .attr(\"transform\", \"translate(\" + posX + \",\" + posY + \")\")\n    .call(xAxis);\n\n  legend.select(\".axis\").select(\".domain\").remove();\n}\n\nfunction drawDiscreteLegendValues(elem, colorOptions, legendWidth) {\n  let thresholds = colorOptions.thresholds;\n\n  let legendElem = $(elem).find('svg');\n  let legend = d3.select(legendElem.get(0));\n\n  if (legendWidth <= 0 || legendElem.get(0).childNodes.length === 0) {\n    return;\n  }\n\n  let valuesNumber = thresholds.length;\n  let rangeStep  = Math.floor(legendWidth / valuesNumber);\n  let valuesRange = d3.range(0, legendWidth, rangeStep);\n\n\n  let legendValueScale = d3.scaleLinear()\n    .domain([0, valuesNumber])\n    .range([0, legendWidth]);\n\n  let thresholdValues = [];\n  let thresholdTooltips = [];\n  for (let i = 0; i < thresholds.length; i++) {\n    thresholdValues.push(thresholds[i].value);\n    thresholdTooltips.push(thresholds[i].tooltip);\n  }\n\n  let xAxis = d3.axisBottom(legendValueScale)\n    .tickValues(d3.range(0, valuesNumber, 1)) //thresholdValues)\n    .tickSize(2)\n    .tickFormat((t) => {\n      let i = Math.floor(t);\n      let v = thresholdTooltips[i];\n      if (v != undefined) {\n        return \"\"+v;\n      } else {\n        v = thresholdValues[i];\n        if (v != undefined) {\n          return \"\"+v;\n        } else {\n          return \"n/a\";\n        }\n      }\n    });\n\n  let colorRect = legendElem.find(\":first-child\");\n  let posY = getSvgElemHeight(legendElem) + 2;\n  let posX = getSvgElemX(colorRect) + Math.floor(rangeStep/2);\n\n  d3.select(legendElem.get(0)).append(\"g\")\n    .attr(\"class\", \"axis\")\n    .attr(\"transform\", \"translate(\" + posX + \",\" + posY + \")\")\n    .call(xAxis);\n\n  legend.select(\".axis\").select(\".domain\").remove();\n}\n\nfunction drawSimpleColorLegend(elem, colorScale) {\n  let legendElem = $(elem).find('svg');\n  clearLegend(elem);\n\n  let legendWidth = Math.floor(legendElem.outerWidth());\n  let legendHeight = legendElem.attr(\"height\");\n\n  if (legendWidth) {\n    let valuesNumber = Math.floor(legendWidth / 2);\n    let rangeStep  = Math.floor(legendWidth / valuesNumber);\n    let valuesRange = d3.range(0, legendWidth, rangeStep);\n\n    let legend = d3.select(legendElem.get(0));\n    var legendRects = legend.selectAll(\".status-heatmap-color-legend-rect\").data(valuesRange);\n\n    legendRects.enter().append(\"rect\")\n      .attr(\"x\", d => d)\n      .attr(\"y\", 0)\n      .attr(\"width\", rangeStep + 1) // Overlap rectangles to prevent gaps\n      .attr(\"height\", legendHeight)\n      .attr(\"stroke-width\", 0)\n      .attr(\"fill\", d => colorScale(d));\n  }\n}\n\nfunction drawSimpleOpacityLegend(elem, options) {\n  let legendElem = $(elem).find('svg');\n  let graphElem = $(elem);\n  clearLegend(elem);\n\n  let legend = d3.select(legendElem.get(0));\n  let legendWidth = Math.floor(legendElem.outerWidth());\n  let legendHeight = legendElem.attr(\"height\");\n\n  if (legendWidth) {\n    let legendOpacityScale;\n    if (options.colorScale === 'linear') {\n      legendOpacityScale = d3.scaleLinear()\n      .domain([0, legendWidth])\n      .range([0, 1]);\n    } else if (options.colorScale === 'sqrt') {\n      legendOpacityScale = d3.scalePow().exponent(options.exponent)\n      .domain([0, legendWidth])\n      .range([0, 1]);\n    }\n\n    let rangeStep = 10;\n    let valuesRange = d3.range(0, legendWidth, rangeStep);\n    var legendRects = legend.selectAll(\".status-heatmap-opacity-legend-rect\").data(valuesRange);\n\n    legendRects.enter().append(\"rect\")\n      .attr(\"x\", d => d)\n      .attr(\"y\", 0)\n      .attr(\"width\", rangeStep)\n      .attr(\"height\", legendHeight)\n      .attr(\"stroke-width\", 0)\n      .attr(\"fill\", options.cardColor)\n      .style(\"opacity\", d => legendOpacityScale(d));\n  }\n}\n\n\nfunction clearLegend(elem) {\n  let legendElem = $(elem).find('svg');\n  legendElem.empty();\n}\n\nfunction getColorScale(colorScheme, maxValue, minValue = 0) {\n  let colorInterpolator = d3ScaleChromatic[colorScheme.value];\n  let colorScaleInverted = colorScheme.invert === 'always' ||\n    (colorScheme.invert === 'dark' && !contextSrv.user.lightTheme);\n\n  let start = colorScaleInverted ? maxValue : minValue;\n  let end = colorScaleInverted ? minValue : maxValue;\n\n  return d3.scaleSequential(colorInterpolator).domain([start, end]);\n}\n\nfunction getOpacityScale(options, maxValue, minValue = 0) {\n  let legendOpacityScale;\n  if (options.colorScale === 'linear') {\n    legendOpacityScale = d3.scaleLinear()\n    .domain([minValue, maxValue])\n    .range([0, 1]);\n  } else if (options.colorScale === 'sqrt') {\n    legendOpacityScale = d3.scalePow().exponent(options.exponent)\n    .domain([minValue, maxValue])\n    .range([0, 1]);\n  }\n  return legendOpacityScale;\n}\n\nfunction getSvgElemX(elem) {\n  let svgElem = elem.get(0);\n  if (svgElem && svgElem.x && svgElem.x.baseVal) {\n    return svgElem.x.baseVal.value;\n  } else {\n    return 0;\n  }\n}\n\nfunction getSvgElemHeight(elem) {\n  let svgElem = elem.get(0);\n  if (svgElem && svgElem.height && svgElem.height.baseVal) {\n    return svgElem.height.baseVal.value;\n  } else {\n    return 0;\n  }\n}\n\nfunction buildLegendTicks(rangeFrom, rangeTo, maxValue, minValue) {\n  let range = rangeTo - rangeFrom;\n  let tickStepSize = tickStep(rangeFrom, rangeTo, 3);\n  let ticksNum = Math.round(range / tickStepSize);\n  let ticks = [];\n\n  for (let i = 0; i < ticksNum; i++) {\n    let current = tickStepSize * i;\n    // Add user-defined min and max if it had been set\n    if (isValueCloseTo(minValue, current, tickStepSize)) {\n      ticks.push(minValue);\n      continue;\n    } else if (minValue < current) {\n      ticks.push(minValue);\n    }\n    if (isValueCloseTo(maxValue, current, tickStepSize)) {\n      ticks.push(maxValue);\n      continue;\n    } else if (maxValue < current) {\n      ticks.push(maxValue);\n    }\n    ticks.push(tickStepSize * i);\n  }\n  if (!isValueCloseTo(maxValue, rangeTo, tickStepSize)) {\n    ticks.push(maxValue);\n  }\n  ticks.push(rangeTo);\n  ticks = _.sortBy(_.uniq(ticks));\n  return ticks;\n}\n\nfunction isValueCloseTo(val, valueTo, step) {\n  let diff = Math.abs(val - valueTo);\n  return diff < step * 0.3;\n}\n"]}